<!-- public/mobile.html -->
<!doctype html>
<html lang="en" class="dark">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Fluency Activity - Mobile</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        colors: {
                            primary: {
                                50: "#eff6ff",
                                100: "#dbeafe",
                                200: "#bfdbfe",
                                300: "#93c5fd",
                                400: "#60a5fa",
                                500: "#3b82f6",
                                600: "#2563eb",
                                700: "#1d4ed8",
                                800: "#1e40af",
                                900: "#1e3a8a",
                                950: "#172554",
                            },
                        },
                    },
                },
            };
        </script>
        <script src="/socket.io/socket.io.js"></script>
    </head>
    <body
        class="bg-gray-900 text-white min-h-screen flex items-center justify-center"
    >
        <div class="max-w-md w-full p-6 bg-gray-800 rounded-lg shadow-xl">
            <h1 class="text-3xl font-bold mb-6 text-center">
                Fluency Activity
            </h1>
            <div id="timer" class="text-2xl mb-6 text-center">
                Waiting for timer to start...
            </div>
            <div class="mb-4">
                <input
                    type="text"
                    id="ideaInput"
                    placeholder="Enter your idea"
                    class="w-full p-3 rounded bg-gray-700 text-white border border-gray-600 focus:border-primary-500 focus:ring focus:ring-primary-200 focus:ring-opacity-50"
                    disabled
                />
            </div>
            <button
                id="submitIdea"
                class="w-full bg-primary-600 hover:bg-primary-700 text-white font-bold py-3 px-4 rounded disabled:opacity-50 transition duration-300"
                disabled
            >
                Submit Idea
            </button>
        </div>

        <script>
            const socket = io();
            let timerInterval;

            socket.on("timerStatus", ({ started, endTime }) => {
                if (started) {
                    enableInputs();
                    updateTimer(endTime);
                    timerInterval = setInterval(
                        () => updateTimer(endTime),
                        1000,
                    );
                }
            });

            socket.on("timerStarted", (endTime) => {
                enableInputs();
                updateTimer(endTime);
                timerInterval = setInterval(() => updateTimer(endTime), 1000);
            });

            socket.on("timerEnded", () => {
                clearInterval(timerInterval);
                document.getElementById("timer").textContent = "Time's up!";
                disableInputs();
            });

            document
                .getElementById("submitIdea")
                .addEventListener("click", () => {
                    const idea = document.getElementById("ideaInput").value;
                    if (idea) {
                        socket.emit("submitIdea", idea);
                        document.getElementById("ideaInput").value = "";
                    }
                });

            function updateTimer(endTime) {
                const remainingTime = Math.max(
                    0,
                    Math.ceil((endTime - Date.now()) / 1000),
                );
                document.getElementById("timer").textContent =
                    `Time remaining: ${remainingTime}s`;
                if (remainingTime === 0) {
                    clearInterval(timerInterval);
                    disableInputs();
                }
            }

            function enableInputs() {
                document.getElementById("ideaInput").disabled = false;
                document.getElementById("submitIdea").disabled = false;
            }

            function disableInputs() {
                document.getElementById("ideaInput").disabled = true;
                document.getElementById("submitIdea").disabled = true;
            }
        </script>
    </body>
</html>
